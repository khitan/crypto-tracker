<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Price Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.3s ease;
        }

        body.light {
            background-color: #f8f9fa;
            color: #333333;
        }

        body.dark {
            background-color: #2b2b2b;
            color: #ffffff;
        }

        .container {
            max-width: 1700px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ddd;
        }

        body.dark header {
            border-bottom-color: #555;
        }

        h1 {
            font-size: 28px;
        }

        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        body.light button {
            background-color: #ffffff;
            color: #333333;
        }

        body.dark button {
            background-color: #404040;
            color: #ffffff;
            border-color: #555;
        }

        button:hover {
            opacity: 0.8;
            transform: translateY(-1px);
        }

        button.active {
            background-color: #4CAF50 !important;
            color: white !important;
        }

        .filter-btn {
            font-size: 18px;
            padding: 6px 12px;
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 5px;
        }

        body.light .status-bar {
            background-color: #e9ecef;
        }

        body.dark .status-bar {
            background-color: #1a1a1a;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        body.light table {
            background-color: white;
        }

        body.dark table {
            background-color: #333;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        body.light th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        body.dark th {
            background-color: #2b2b2b;
            border-bottom: 2px solid #555;
        }

        th:hover {
            opacity: 0.8;
        }

        th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.3;
        }

        th.sorted-asc::after {
            content: ' ‚Üë';
            opacity: 1;
        }

        th.sorted-desc::after {
            content: ' ‚Üì';
            opacity: 1;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #ddd;
        }

        body.dark td {
            border-bottom-color: #444;
        }

        tr:hover {
            background-color: rgba(0,0,0,0.03);
        }

        body.dark tr:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .positive {
            color: #00aa00;
        }

        .negative {
            color: #cc0000;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            border-radius: 8px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        body.light .modal-content {
            background-color: white;
        }

        body.dark .modal-content {
            background-color: #333;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            font-size: 24px;
        }

        .close-btn {
            font-size: 28px;
            cursor: pointer;
            border: none;
            background: none;
            color: inherit;
            padding: 0;
            width: 30px;
            height: 30px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-box input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        body.light .search-box input {
            background-color: white;
            color: #333;
        }

        body.dark .search-box input {
            background-color: #404040;
            color: white;
            border-color: #555;
        }

        .coin-list {
            list-style: none;
            max-height: 300px;
            overflow-y: auto;
        }

        .coin-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid #ddd;
        }

        body.light .coin-item {
            background-color: #f8f9fa;
        }

        body.dark .coin-item {
            background-color: #404040;
            border-color: #555;
        }

        .coin-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .settings-group {
            margin-bottom: 25px;
        }

        .settings-group h3 {
            margin-bottom: 15px;
            font-size: 18px;
        }

        .setting-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 12px;
        }

        .setting-row label {
            min-width: 120px;
        }

        input[type="number"], input[type="range"] {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        body.dark input[type="number"] {
            background-color: #404040;
            color: white;
            border-color: #555;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state h3 {
            margin-bottom: 15px;
            font-size: 22px;
        }

        .watchlist-table {
            margin-top: 20px;
        }

        .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
        }

        .remove-btn:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body class="light">
    <div class="container">
        <header>
            <h1>üöÄ Crypto Price Tracker</h1>
            <div class="controls">
                <button id="addCoinBtn">+ Add Coin</button>
                <button id="watchlistBtn">üìã Watchlist</button>
                <button id="settingsBtn">‚öôÔ∏è Settings</button>
                <button id="themeBtn">üåì Theme</button>
            </div>
        </header>

        <div class="status-bar">
            <div id="statusText">Ready</div>
            <div>
                <button id="filter30Btn" class="filter-btn" title="Show coins with 24h change > 30%">üí£</button>
                <button id="filter60Btn" class="filter-btn" title="Show coins with 24h change > 60%">2Xüí£</button>
                <button id="refreshBtn">üîÑ Refresh</button>
            </div>
        </div>

        <div class="table-container">
            <table id="mainTable">
                <thead>
                    <tr>
                        <th>Coin</th>
                        <th>Price (USD)</th>
                        <th class="sortable" data-sort="change">24H (%)</th>
                        <th class="sortable" data-sort="volume">Volume (24h)</th>
                        <th class="sortable" data-sort="marketcap">Market Cap</th>
                        <th>Boomed Status</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="6" class="loading">Loading data...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Add Coin Modal -->
    <div id="addCoinModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Coin to Watchlist</h2>
                <button class="close-btn" onclick="closeModal('addCoinModal')">&times;</button>
            </div>
            <div class="search-box">
                <input type="text" id="coinSearchInput" placeholder="Enter coin symbol (e.g., BTC, ETH)">
                <button onclick="searchCoin()">Search</button>
            </div>
            <div id="searchStatus"></div>
            <ul id="coinList" class="coin-list"></ul>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="addAllCoins()">Add All</button>
                <button onclick="closeModal('addCoinModal')">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Watchlist Modal -->
    <div id="watchlistModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Watchlist</h2>
                <button class="close-btn" onclick="closeModal('watchlistModal')">&times;</button>
            </div>
            <div class="watchlist-table">
                <table>
                    <thead>
                        <tr>
                            <th>Coin</th>
                            <th>Price (USD)</th>
                            <th>Market Cap (USD)</th>
                            <th>Volume (24h)</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="watchlistBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="close-btn" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="settings-group">
                <h3>Appearance</h3>
                <div class="setting-row">
                    <label>Theme:</label>
                    <select id="themeSelect">
                        <option value="light">Light Mode</option>
                        <option value="dark">Dark Mode</option>
                    </select>
                </div>
                <div class="setting-row">
                    <label>Font Size:</label>
                    <input type="number" id="fontSizeInput" min="10" max="20" value="14">
                </div>
                <div class="setting-row">
                    <label>Row Height:</label>
                    <input type="number" id="rowHeightInput" min="30" max="80" value="45">
                </div>
            </div>
            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="saveSettings()">Save</button>
                <button onclick="closeModal('settingsModal')">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Storage management
        const storage = {
            get: (key) => {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },
            set: (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            }
        };

        // State
        let watchlist = storage.get('watchlist') || [];
        let currentData = [];
        let filter30Active = false;
        let filter60Active = false;
        let sortColumn = null;
        let sortOrder = 'desc';
        let searchResults = [];
        let settings = storage.get('settings') || {
            theme: 'light',
            fontSize: 14,
            rowHeight: 45
        };

        // API functions
        const API_BASE = 'https://api.coingecko.com/api/v3';

        async function searchCoinAPI(symbol) {
            try {
                const response = await fetch(`${API_BASE}/search?query=${encodeURIComponent(symbol)}`);
                const data = await response.json();
                return data.coins || [];
            } catch (error) {
                console.error('Search error:', error);
                return [];
            }
        }

        async function getCoinData(coinIds) {
            if (!coinIds.length) return [];
            
            try {
                const ids = coinIds.join(',');
                const response = await fetch(
                    `${API_BASE}/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&per_page=250&page=1&sparkline=false`
                );
                return await response.json();
            } catch (error) {
                console.error('Data fetch error:', error);
                return [];
            }
        }

        // UI functions
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function updateStatus(text) {
            document.getElementById('statusText').textContent = text;
        }

        async function searchCoin() {
            const input = document.getElementById('coinSearchInput');
            const symbol = input.value.trim();
            
            if (!symbol) {
                alert('Please enter a coin symbol');
                return;
            }

            document.getElementById('searchStatus').textContent = 'Searching...';
            document.getElementById('coinList').innerHTML = '';
            
            searchResults = await searchCoinAPI(symbol);
            
            if (searchResults.length === 0) {
                document.getElementById('searchStatus').textContent = 'No coins found';
                return;
            }

            document.getElementById('searchStatus').textContent = `Found ${searchResults.length} coins:`;
            
            const coinList = document.getElementById('coinList');
            coinList.innerHTML = searchResults.map(coin => `
                <li class="coin-item" onclick="addCoin('${coin.id}', '${coin.name}', '${coin.symbol}')">
                    ${coin.name} (${coin.symbol.toUpperCase()}) - ${coin.id}
                </li>
            `).join('');
        }

        function addCoin(id, name, symbol) {
            if (watchlist.some(c => c.id === id)) {
                alert('Coin already in watchlist!');
                return;
            }

            watchlist.push({ id, name, symbol });
            storage.set('watchlist', watchlist);
            
            closeModal('addCoinModal');
            loadMainData();
            alert(`Added ${name} to watchlist!`);
        }

        function addAllCoins() {
            let added = 0;
            searchResults.forEach(coin => {
                if (!watchlist.some(c => c.id === coin.id)) {
                    watchlist.push({ id: coin.id, name: coin.name, symbol: coin.symbol });
                    added++;
                }
            });

            if (added > 0) {
                storage.set('watchlist', watchlist);
                closeModal('addCoinModal');
                loadMainData();
                alert(`Added ${added} coins to watchlist!`);
            } else {
                alert('All coins are already in watchlist!');
            }
        }

        function removeCoin(coinId) {
            if (confirm(`Remove this coin from watchlist?`)) {
                watchlist = watchlist.filter(c => c.id !== coinId);
                storage.set('watchlist', watchlist);
                loadMainData();
                showWatchlist();
            }
        }

        async function loadMainData() {
            if (watchlist.length === 0) {
                document.getElementById('tableBody').innerHTML = `
                    <tr><td colspan="6" class="empty-state">
                        <h3>No coins in watchlist</h3>
                        <p>Click "Add Coin" to start tracking cryptocurrencies</p>
                    </td></tr>
                `;
                updateStatus('No coins in watchlist');
                return;
            }

            updateStatus('Loading data...');
            const coinIds = watchlist.map(c => c.id);
            currentData = await getCoinData(coinIds);
            updateMainTable();
            updateStatus(`Loaded ${currentData.length} coins`);
        }

        function getFilteredData() {
            let data = [...currentData];
            
            if (filter30Active) {
                data = data.filter(c => c.price_change_percentage_24h > 30);
            } else if (filter60Active) {
                data = data.filter(c => c.price_change_percentage_24h > 60);
            }

            return data;
        }

        function sortData(data, column, order) {
            const sorted = [...data];
            
            sorted.sort((a, b) => {
                let valA, valB;
                
                switch(column) {
                    case 'change':
                        valA = a.price_change_percentage_24h || -999999;
                        valB = b.price_change_percentage_24h || -999999;
                        break;
                    case 'volume':
                        valA = a.total_volume || 0;
                        valB = b.total_volume || 0;
                        break;
                    case 'marketcap':
                        valA = a.market_cap || 0;
                        valB = b.market_cap || 0;
                        break;
                    default:
                        return 0;
                }

                return order === 'asc' ? valA - valB : valB - valA;
            });

            return sorted;
        }

        function calculateBoomedIndicator(changePercentage) {
            if (!changePercentage || changePercentage <= 0) return '';
            
            const dots = Math.min(Math.floor(changePercentage / 10), 10);
            const rockets = Math.min(Math.floor(changePercentage / 100), 5);
            
            return 'üü¢'.repeat(dots) + 'üöÄ'.repeat(rockets);
        }

        function updateMainTable() {
            let data = getFilteredData();
            
            if (sortColumn) {
                data = sortData(data, sortColumn, sortOrder);
            }

            const tbody = document.getElementById('tableBody');
            
            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="empty-state">No coins match the current filter</td></tr>';
                return;
            }

            tbody.innerHTML = data.map(coin => {
                const change = coin.price_change_percentage_24h;
                const changeClass = change > 0 ? 'positive' : 'negative';
                const changeIcon = change > 0 ? 'üìà' : 'üìâ';
                
                return `
                    <tr>
                        <td><strong>${coin.symbol.toUpperCase()}</strong></td>
                        <td>$${coin.current_price?.toLocaleString(undefined, {minimumFractionDigits: 3, maximumFractionDigits: 3}) || 'N/A'}</td>
                        <td class="${changeClass}">${changeIcon}${change?.toFixed(2) || 'N/A'}%</td>
                        <td>$${coin.total_volume?.toLocaleString() || 'N/A'}</td>
                        <td>üí∞$${coin.market_cap?.toLocaleString() || 'N/A'}</td>
                        <td>${calculateBoomedIndicator(change)}</td>
                    </tr>
                `;
            }).join('');

            applyRowHeight();
        }

        async function showWatchlist() {
            showModal('watchlistModal');
            
            if (watchlist.length === 0) {
                document.getElementById('watchlistBody').innerHTML = 
                    '<tr><td colspan="5" class="empty-state">Watchlist is empty</td></tr>';
                return;
            }

            const coinIds = watchlist.map(c => c.id);
            const data = await getCoinData(coinIds);
            
            document.getElementById('watchlistBody').innerHTML = data.map(coin => `
                <tr>
                    <td>${coin.symbol.toUpperCase()}</td>
                    <td>$${coin.current_price?.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2}) || 'N/A'}</td>
                    <td>$${coin.market_cap?.toLocaleString() || 'N/A'}</td>
                    <td>$${coin.total_volume?.toLocaleString() || 'N/A'}</td>
                    <td><button class="remove-btn" onclick="removeCoin('${coin.id}')">Remove</button></td>
                </tr>
            `).join('');
        }

        function toggleFilter(percentage) {
            if (percentage === 30) {
                filter30Active = !filter30Active;
                filter60Active = false;
                document.getElementById('filter30Btn').classList.toggle('active', filter30Active);
                document.getElementById('filter60Btn').classList.remove('active');
            } else {
                filter60Active = !filter60Active;
                filter30Active = false;
                document.getElementById('filter60Btn').classList.toggle('active', filter60Active);
                document.getElementById('filter30Btn').classList.remove('active');
            }
            
            updateMainTable();
        }

        function handleSort(column) {
            if (sortColumn === column) {
                sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
            } else {
                sortColumn = column;
                sortOrder = 'desc';
            }

            // Update header indicators
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
            });

            const header = document.querySelector(`th[data-sort="${column}"]`);
            header.classList.add(sortOrder === 'asc' ? 'sorted-asc' : 'sorted-desc');

            updateMainTable();
        }

        function applyTheme() {
            document.body.className = settings.theme;
        }

        function applyRowHeight() {
            const style = document.createElement('style');
            style.innerHTML = `
                #mainTable tbody tr, #watchlistBody tr {
                    height: ${settings.rowHeight}px;
                }
            `;
            document.head.appendChild(style);
        }

        function applyFontSize() {
            document.body.style.fontSize = `${settings.fontSize}px`;
        }

        function showSettings() {
            showModal('settingsModal');
            document.getElementById('themeSelect').value = settings.theme;
            document.getElementById('fontSizeInput').value = settings.fontSize;
            document.getElementById('rowHeightInput').value = settings.rowHeight;
        }

        function saveSettings() {
            settings.theme = document.getElementById('themeSelect').value;
            settings.fontSize = parseInt(document.getElementById('fontSizeInput').value);
            settings.rowHeight = parseInt(document.getElementById('rowHeightInput').value);
            
            storage.set('settings', settings);
            applyTheme();
            applyFontSize();
            applyRowHeight();
            
            closeModal('settingsModal');
        }

        function toggleTheme() {
            settings.theme = settings.theme === 'light' ? 'dark' : 'light';
            storage.set('settings', settings);
            applyTheme();
        }

        // Event listeners
        document.getElementById('addCoinBtn').addEventListener('click', () => {
            showModal('addCoinModal');
            document.getElementById('coinSearchInput').value = '';
            document.getElementById('searchStatus').textContent = '';
            document.getElementById('coinList').innerHTML = '';
        });

        document.getElementById('watchlistBtn').addEventListener('click', showWatchlist);
        document.getElementById('settingsBtn').addEventListener('click', showSettings);
        document.getElementById('themeBtn').addEventListener('click', toggleTheme);
        document.getElementById('filter30Btn').addEventListener('click', () => toggleFilter(30));
        document.getElementById('filter60Btn').addEventListener('click', () => toggleFilter(60));
        document.getElementById('refreshBtn').addEventListener('click', loadMainData);

        document.getElementById('coinSearchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') searchCoin();
        });

        document.querySelectorAll('th.sortable').forEach(th => {
            th.addEventListener('click', () => {
                const sortType = th.dataset.sort;
                handleSort(sortType);
            });
        });

        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeModal(modal.id);
                }
            });
        });

        // Initialize
        applyTheme();
        applyFontSize();
        applyRowHeight();
        loadMainData();

        // Auto refresh every 30 seconds
        setInterval(loadMainData, 30000);
    </script>
</body>
</html>